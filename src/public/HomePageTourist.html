<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tourist</title>
    <style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
}

.header {
    background-color: #4CAF50; /* Header background color */
    color: white;
    padding: 20px;
    text-align: center;
}

.header h1 {
    margin: 0;
}

.button-container {
    margin-top: 10px;
    text-align: center; /* Center the buttons */
}

button {
    background-color: #4CAF50; /* Button color */
    color: white;
    border: none;
    padding: 10px 15px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 5px; /* Space between buttons */
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s;
}

button:hover {
    background-color: #45a049; /* Darker green on hover */
}

.search-container {
    padding: 20px;
    text-align: center;
}

#searchInput {
    padding: 10px;
    width: 300px;
    border-radius: 5px;
    border: 1px solid #ccc;
}

.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto; /* 15% from the top and centered */
    padding: 20px;
    border: 1px solid #888;
    width: 80%; /* Could be more or less, depending on screen size */
    border-radius: 10px;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

h2 {
    text-align: center;
    color: #333;
}

.form-row {
    margin-bottom: 10px;
}

label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

input[type="text"],
input[type="email"],
input[type="number"],
input[type="date"],
input[type="url"],
input[type="password"] {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
}

#filter {
    margin-top: 10px;
}

.activity, .museum, .itinerary, .historical-place {
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 10px;
    margin: 10px 0;
    background-color: #fff;
}

.details {
    margin-top: 10px;
    padding: 10px;
    border: 1px dashed #ccc;
    border-radius: 5px;
    background-color: #f9f9f9;
}

.details p {
    margin: 5px 0;
}
    </style>
</head>
<body>

<div class="header">
    <h1>Beyond Borders</h1>
    <div>
        <button onclick="viewAllActivities()">View All Activities</button>
        <button onclick="viewAllMuseums()">View All Museums</button>
        <button onclick="viewAllItineraries()">View All Itineraries</button>
        <button onclick="viewAllHistoricalPlaces()">View All Historical Places</button>
        <button onclick="viewAllProducts()">View All Products</button>
        <button onclick="readMyProfile()">My Profile</button>
    </div>
    
</div>
<div class="search-container">
    <input type="text" id="searchInput" placeholder="Search for a product by name...">
    <button class="search-button" onclick="searchProducts()">Search</button>
</div>

<div class="filter-container"></div>
    <input type="number" id="minPrice" placeholder="Minimum Price" />
    <input type="number" id="maxPrice" placeholder="Maximum Price" />
    <button class="search-button" onclick="filterProductsByPrice()">Filter</button>
</div>

<div class="sort-container">
    <button onclick="sortProductsDescending()">Sort by Rating (Descending)</button>
    <button onclick="sortProductsAscending()">Sort by Rating (Ascending)</button>
</div>

<div id="productsModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeProductsModal()">&times;</span>
        <h2>All Products</h2>
        <div id="productsList">
            <!-- Products will be displayed here -->
        </div>
    </div>
</div>


<div id="activitiesModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeActivitiesModal()">&times;</span>
        <h2>Upcoming Activities</h2>

        <!-- Search Bar -->
        <label for="search">Search Activities:</label>
        <input type="text" id="search" placeholder="Search by keyword" />
        <button id="searchButton">Search</button>

        <!-- Filter Options -->
        <label for="category">Category:</label>
        <input type="text" id="category" placeholder="Enter category" />

        <label for="minPrice1">Min Price:</label>
        <input type="number" id="minPrice1" placeholder="Minimum Price" />

        <label for="maxPrice1">Max Price:</label>
        <input type="number" id="maxPrice1" placeholder="Maximum Price" />

        <label for="InputDate">Date:</label>
        <input type="date" id="InputDate" />

        <label for="Rating">Rating:</label>
        <input type="number" id="Rating" min="1" max="5" placeholder="Rating (1-5)" />

        <button id="filter">Apply Filter</button>
        <button onclick="sortActivitesPriceDescending()">Sort by Price (Descending)</button>
        <button onclick="sortActivitesPriceAscending()">Sort by Price (Ascending)</button>
        <button onclick="sortActivitesRatingDescending()">Sort by Rating (Descending)</button>
        <button onclick="sortActivitesRatingAscending()">Sort by Rating (Ascending)</button>

        <!-- Container for displaying activities -->
        <div id="activitiesContainerModal">
            <!-- Activities will be displayed here -->
        </div>
    </div>
</div>



<!-- Modal for Activities -->
<div id="activitiesModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeActivitiesModal()">&times;</span>
        <h2>Upcoming Activities</h2>
        <div id="activitiesContainerModal">
            <!-- Activities will be displayed here -->
        </div>
    </div>
</div>

<!-- Modal for Museums -->
<div id="museumsModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeMuseumsModal()">&times;</span>
        <h2>Upcoming Museum Events</h2>

        <!-- Search Bar for Museum Events -->
        <label for="museumSearch">Search Museum Events:</label>
        <input type="text" id="museumSearch" placeholder="Enter search keyword" />
        <button id="museumSearchButton">Search</button>

        <label for="tags">Filter by Tags (comma-separated):</label>
        <input type="text" id="tags" placeholder="Enter tags" />
        <button id="filterMuseums">Apply Tag Filter</button>

        <div id="museumsContainerModal">
            <!-- Museums will be displayed here -->
        </div>
    </div>
</div>


<div id="itineraryModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeItineraryModal()">&times;</span>
        <h2>Upcoming Itinerary Events</h2>

        <!-- Search Bar -->
        <label for="itinerarySearch">Search:</label>
        <input type="text" id="itinerarySearch" placeholder="Enter search term" />
        <button id="itinerarySearchButton">Search</button>

        <label for="language">Language:</label>
        <input type="text" id="language" placeholder="language" >

        <label for="minPrice2">Min Price:</label>
        <input type="number" id="minPrice2" placeholder="Minimum Price" />

        <label for="maxPrice2">Max Price:</label>
        <input type="number" id="maxPrice2" placeholder="Maximum Price" />

        <label for="InputDate2">Date:</label>
        <input type="date" id="InputDate2" placeholder="date" />

    
        <label for="tags2">Tags:</label>
        <input type="text" id="tags2">

        <!-- Buttons for filtering and sorting -->
        <button id="filter1">Apply Filter</button>
        <button onclick="sortItinerariesPriceDescending()">Sort by Price (Descending)</button>
        <button onclick="sortItinerariesPriceAscending()">Sort by Price (Ascending)</button>
        
        <div id="itineraryContainerModal">
            <!-- Itineraries will be displayed here -->
        </div>
    </div>
</div>


<div id="HistoricalPlacesModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeHistoricalPlacesModal()">&times;</span>
        <h2>Upcoming Historical Places Events</h2>

        <!-- Search Bar -->
        <label for="historicalPlacesSearch">Search:</label>
        <input type="text" id="historicalPlacesSearch" placeholder="Search for historical places..." />
        <!-- Search Button -->
        <button id="searchHistoricalPlacesButton">Search</button>
        <label for="historicalTags">Filter by Tags (comma-separated):</label>
        <input type="text" id="historicalTags" placeholder="Enter tags" />
        <button id="filterHistoricalPlaces">Apply Tag Filter</button>

        <!-- Container for displaying historical places -->
        <div id="HistoricalPlacesContainerModal">
            <!-- Historical Places will be displayed here -->
        </div>
    </div>
</div>





<!-- Modal for Profile -->
<div id="profileModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>My Profile</h2>
        <form id="profile-form">
            <div class="form-row">
                <label for="username">Username:</label>
                <input type="text" id="username" readonly>
            </div>
            <div class="form-row">
                <label for="email">Email Address:</label>
                <input type="email" id="email">
            </div>
            <div class="form-row">
                <label for="password">Password:</label>
                <input type="password" id="password">
            </div>
            <div class="form-row">
                <label for="mobileNumber">Mobile Number</label>
                <input type="text" id="mobileNumber">
            </div>
            <div class="form-row">
                <label for="doB">Date of Birth:</label>
                <input type="text" id="doB" readonly>
            </div>
            <div class="form-row">
                <label for="nationality">Nationality:</label>
                <input type="url" id="nationality">
            </div>
            <div class="form-row">
                <label for="occupation">Occupation:</label>
                <input type="url" id="occupation">
            </div>
            <div>
                <label for="wallet">Wallet:</label>
                <input type="url" id="wallet" readonly>
            </div>
            <button type="button" id="save-changes-btn" onclick="saveProfile()">Save Changes</button>
        </form>
    </div>
</div>



<script>

async function searchProducts() {
    const searchName = document.getElementById('searchInput').value.trim(); // Correct ID for input
    if (!searchName) {
        alert('Please enter a product name to search.');
        return;
    }

    try {
        const response = await fetch(`/api/viewProductsSeller?Name=${encodeURIComponent(searchName)}`, {
            method: 'GET', // Use GET for query parameters
            headers: {
                'Content-Type': 'application/json'
            }
        });

        const products = await response.json();

        if (response.ok) {
            displayProducts(products);
            openProductsModal();
        } else {
            alert(products.error || 'No products found.');
        }
    } catch (error) {
        console.error('Error fetching products:', error);
        alert('An error occurred while searching for products.');
    }
}

async function filterProductsByPrice() {
    const minimumPrice = document.getElementById('minPrice').value;
    const maximumPrice = document.getElementById('maxPrice').value;

    // Validate input
    if (!minimumPrice && !maximumPrice) {
        alert('Please enter at least one price.');
        return;
    }

    const filterCriteria = {};
    if (minimumPrice) {
        filterCriteria.MinimumPrice = Number(minimumPrice);
    }
    if (maximumPrice) {
        filterCriteria.MaximumPrice = Number(maximumPrice);
    }

    try {
        const response = await fetch('/api/filterProductByPriceTourist', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(filterCriteria)
        });

        const products = await response.json();

        if (response.ok) {
            displayProducts(products); // Use the existing display function
            openProductsModal(); // Open the products modal
        } else {
            alert(products.msg || 'No products found in the specified price range.');
        }
    } catch (error) {
        console.error('Error fetching filtered products:', error);
        alert('An error occurred while filtering products.');
    }
}

async function sortProductsDescending() {
    try {
        const response = await fetch('/api/sortProductsDescendingTourist');
        const products = await response.json();

        if (response.ok) {
            displayProducts(products); // Display products in the modal
            openProductsModal();
        } else {
            alert(products.error || 'Failed to sort products.');
        }
    } catch (error) {
        console.error('Error fetching sorted products:', error);
        alert('An error occurred while sorting products.');
    }
}

async function sortProductsAscending() {
    try {
        const response = await fetch('/api/sortProductsAscendingTourist');
        const products = await response.json();

        if (response.ok) {
            displayProducts(products); // Display products in the modal
            openProductsModal();
        } else {
            alert(products.error || 'Failed to sort products.');
        }
    } catch (error) {
        console.error('Error fetching sorted products:', error);
        alert('An error occurred while sorting products.');
    }
}

function toggleDetails(button) {
    const details = button.nextElementSibling; // Get the details div
    if (details.style.display === "none") {
        details.style.display = "block"; // Show details
    } else {
        details.style.display = "none"; // Hide details
    }
}

function toggleDetails(button) {
        const detailsDiv = button.nextElementSibling;
        detailsDiv.style.display = detailsDiv.style.display === 'none' ? 'block' : 'none';
    }

async function readMyProfile() {
    const username = localStorage.getItem('username');
    if (!username) {
        alert('You need to log in first.');
        return;
    }

    try {
        const response = await fetch(`/api/viewTourist?Username=${encodeURIComponent(username)}`);
        const data = await response.json();

        if (response.ok) {
            console.log(data);
            populateProfileForm(data); // No need to access 'Tourist' as the user is directly returned
            openModal(); // Open profile modal
        } else {
            alert(data.msg); // Use 'msg' instead of 'error' based on the API response
        }
    } catch (error) {
        console.error('Error fetching profile:', error);
        alert('An error occurred while loading profile.');
    }
}

async function viewAllActivities() {
    try {
        const response = await fetch('/api/ViewAllUpcomingActivities');
        const activities = await response.json();

        if (response.ok) {
            displayActivities(activities);
            openActivitiesModal(); // Open the activities modal
        } else {
            alert('Failed to fetch activities: ' + (activities.error || 'Unknown error'));
        }
    } catch (error) {
        console.error('Error fetching activities:', error);
        alert('An error occurred while loading activities.');
    }
}

        

async function viewAllMuseums() {
    try {
        const response = await fetch('/api/ViewAllUpcomingMuseumEventsTourist');
        const museums = await response.json();

        if (response.ok) {
            displayMuseums(museums);
            openMuseumsModal(); // Open the museums modal
        } else {
            alert('Failed to fetch museums: ' + (museums.error || 'Unknown error'));
        }
    } catch (error) {
        console.error('Error fetching museums:', error);
        alert('An error occurred while loading museums.');
    }
}

async function viewAllItineraries() {
    try {
        const response = await fetch('/api/ViewAllUpcomingItinerariesTourist');
        const itineraries = await response.json();

        if (response.ok) {
            displayItineraries(itineraries);
            openItineraryModal(); 
        } else {
            alert('Failed to fetch itineraries: ' + (itineraries.error || 'Unknown error'));
        }
    } catch (error) {
        console.error('Error fetching itineraries:', error);
        alert('An error occurred while loading itineraries.');
    }
}

async function viewAllHistoricalPlaces() {
    try {
        const response = await fetch('/api/ViewAllUpcomingHistoricalPlacesEventsTourist');
        const historicalPlaces = await response.json();

        if (response.ok) {
            displayHistoricalPlaces(historicalPlaces);
            openHistoricalPlacesModal(); // Open the HistoricalPlaces modal
        } else {
            alert('Failed to fetch historical places: ' + (historicalPlaces.error || 'Unknown error'));
        }
    } catch (error) {
        console.error('Error fetching Historical Places:', error);
        alert('An error occurred while loading historical places.');
    }
}

async function searchActivity() {
    const searchName = document.getElementById('searchInput').value.trim(); // Correct ID for input
    if (!searchName) {
        alert('Please enter a product name to search.');
        return;
    }

    try {
        const response = await fetch(`/api/viewProductsSeller?Name=${encodeURIComponent(searchName)}`, {
            method: 'GET', // Use GET for query parameters
            headers: {
                'Content-Type': 'application/json'
            }
        });

        const products = await response.json();

        if (response.ok) {
            displayProducts(products);
            openProductsModal();
        } else {
            alert(products.error || 'No products found.');
        }
    } catch (error) {
        console.error('Error fetching products:', error);
        alert('An error occurred while searching for products.');
    }
}

async function sortActivitesPriceDescending() {
    try {
        const response = await fetch('/sortActivitiesPriceDescendingTourist');
        const activities = await response.json();

        if (response.ok) {
            displayActivities(activities); // Display products in the modal
            openActivitiesModal();
        } else {
            alert(activities.error || 'Failed to sort activities.');
        }
    } catch (error) {
        console.error('Error fetching sorted activities:', error);
        alert('An error occurred while sorting activities.');
    }
}


async function sortActivitesPriceAscending() {
    try {
        const response = await fetch('/sortActivitiesPriceAscendingTourist');
        const activities = await response.json();

        if (response.ok) {
            displayActivities(activities); // Display products in the modal
            openActivitiesModal();
        } else {
            alert(activities.error || 'Failed to sort activities.');
        }
    } catch (error) {
        console.error('Error fetching sorted activities:', error);
        alert('An error occurred while sorting activities.');
    }
}


async function sortActivitesRatingDescending() {
    try {
        const response = await fetch('/sortActivitiesRatingDescendingTourist');
        const activities = await response.json();

        if (response.ok) {
            displayActivities(activities); // Display products in the modal
            openActivitiesModal();
        } else {
            alert(activities.error || 'Failed to sort activities.');
        }
    } catch (error) {
        console.error('Error fetching sorted activities:', error);
        alert('An error occurred while sorting activities.');
    }
}

async function sortActivitesRatingAscending() {
    try {
        const response = await fetch('/sortActivitiesRatingAscendingTourist');
        const activities = await response.json();

        if (response.ok) {
            displayActivities(activities); // Display products in the modal
            openActivitiesModal();
        } else {
            alert(activities.error || 'Failed to sort activities.');
        }
    } catch (error) {
        console.error('Error fetching sorted activities:', error);
        alert('An error occurred while sorting activities.');
    }
}

async function sortItinerariesPriceDescending() {
    try {
        const response = await fetch('/sortItinerariesPriceDescendingTourist');
        const itineraries = await response.json();

        if (response.ok) {
            displayItineraries(itineraries); // Display products in the modal
            openItineraryModal();
        } else {
            alert(itineraries.error || 'Failed to sort itineraries.');
        }
    } catch (error) {
        console.error('Error fetching sorted itineraries:', error);
        alert('An error occurred while sorting itineraries.');
    }
}

async function sortItinerariesPriceAscending() {
    try {
        const response = await fetch('/sortItinerariesPriceAscendingTourist');
        const itineraries = await response.json();

        if (response.ok) {
            displayItineraries(itineraries); // Display products in the modal
            openItineraryModal();
        } else {
            alert(itineraries.error || 'Failed to sort itineraries.');
        }
    } catch (error) {
        console.error('Error fetching sorted itineraries:', error);
        alert('An error occurred while sorting itineraries.');
    }
}

function openActivitiesModal() {
        document.getElementById("activitiesModal").style.display = "block";
    }

    function closeActivitiesModal() {
        document.getElementById("activitiesModal").style.display = "none";
    }

function openMuseumsModal() {
    document.getElementById("museumsModal").style.display = "block"; // Open the museums modal
}

function closeMuseumsModal() {
    document.getElementById("museumsModal").style.display = "none"; // Close the museums modal
}

function openItineraryModal() {
    document.getElementById("itineraryModal").style.display = "block"; // Open the museums modal
}

function closeItineraryModal() {
    document.getElementById("itineraryModal").style.display = "none"; // Close the museums modal
}

function openHistoricalPlacesModal() {
    document.getElementById("HistoricalPlacesModal").style.display = "block"; // Open the Historical Places modal
}

function closeHistoricalPlacesModal() {
    document.getElementById("HistoricalPlacesModal").style.display = "none"; // Close the Historical Places modal
}

function openProductsModal() {
    document.getElementById("productsModal").style.display = "block";
}

function closeProductsModal() {
    document.getElementById("productsModal").style.display = "none";
}

function displayActivities(activities) {
        const container = document.getElementById('activitiesContainerModal');
        container.innerHTML = ''; // Clear previous activities

        if (activities.length === 0) {
            container.innerHTML = '<p>No activities found.</p>';
            return;
        }

        activities.forEach(activity => {
            const activityDiv = document.createElement('div');
            activityDiv.className = 'activity';
            activityDiv.innerHTML = `
                <h3 style="display: inline;">${activity.Name}</h3>
                <button onclick="toggleDetails(this)" style="margin-left: 10px;">View Details</button>
                <div class="details" style="display: none;">
                    <p>Date: ${new Date(activity.Date).toLocaleDateString()}</p>
                    <p>Time: ${activity.Time}</p>
                    <p>Price: $${activity.Price}</p>
                    <p>Rating: ${activity.Rating}</p>
                    <p>Location: ${activity.Location.address || 'N/A'}</p>
                    <p>Category: ${activity.Category}</p>
                    <p>Tags: ${activity.Tags.join(', ')}</p>
                    <p>Special Discount: ${activity.SpecialDiscount || 'N/A'}</p>
                    <p>Booking Status: ${activity.BookingOpen}</p>
                </div>
            `;
            container.appendChild(activityDiv);
        });
    }

function displayMuseums(museums) {
    const container = document.getElementById('museumsContainerModal');
    container.innerHTML = ''; // Clear previous museums

    if (museums.length === 0) {
        container.innerHTML = '<p>No museums found.</p>';
        return;
    }

    museums.forEach(museum => {
        const museumDiv = document.createElement('div');
        museumDiv.className = 'museum';
        museumDiv.innerHTML = `
            <h3 style="display: inline;">${museum.name}</h3>
            <button onclick="toggleDetails(this)" style="margin-left: 10px;">View Details</button>
            <div class="details" style="display: none;">
                <p>Description: ${museum.description}</p>
                <p>Pictures: ${museum.pictures.join(', ')}</p>
                <p>Location: ${museum.location}</p>
                <p>Opening Hours: ${museum.openingHours}</p>
                <p>Ticket Prices: Foreigner: ${museum.ticketPrices.foreigner}, Native: ${museum.ticketPrices.native}, Student: ${museum.ticketPrices.student}</p>
                <p>Author: ${museum.AuthorUsername}</p>
                <p>Historical Tags: ${museum.HistoricalTags.join(', ')}</p>
                <p>Date of Event: ${museum.dateOfEvent ? new Date(museum.dateOfEvent).toLocaleDateString() : 'N/A'}</p>
            </div>
        `;
        container.appendChild(museumDiv);
    });
}

function displayItineraries(itineraries) {
    const container = document.getElementById('itineraryContainerModal');
    container.innerHTML = ''; 

    if (itineraries.length === 0) {
        container.innerHTML = '<p>No itineraries found.</p>';
        return;
    }

    itineraries.forEach(itinerary => {
    const itineraryDiv = document.createElement('div');
    itineraryDiv.className = 'itinerary';
    itineraryDiv.innerHTML = `
        <h3 style="display: inline;">${itinerary.Title}</h3>
        <button onclick="toggleDetails(this)" style="margin-left: 10px;">View Details</button>
        <div class="details" style="display: none;">
            <p>Activities: ${itinerary.Activities}</p>
            <p>Locations: ${itinerary.Locations}</p>
            <p>Timeline: ${itinerary.Timeline}</p>
            <p>Language: ${itinerary.Language}</p>
            <p>Price: $${itinerary.Price}</p>
            <p>Date: ${new Date(itinerary.Date).toLocaleDateString()}</p>
            <p>Accessibility: ${itinerary.accessibility ? 'Yes' : 'No'}</p>
            <p>Pickup Location: ${itinerary.pickupLocation}</p>
            <p>Dropoff Location: ${itinerary.dropoffLocation}</p>
            <p>Is Booked: ${itinerary.isBooked ? 'Yes' : 'No'}</p>
            <p>Tags: ${itinerary.Tags.join(', ')}</p>
            <p>Author: ${itinerary.AuthorUsername}</p>
        </div>
    `;
    container.appendChild(itineraryDiv);
});
}

function displayHistoricalPlaces(historicalPlaces) {
    const container = document.getElementById('HistoricalPlacesContainerModal');
    container.innerHTML = ''; // Clear previous Historical Places

    if (historicalPlaces.length === 0) {
        container.innerHTML = '<p>No Historical Places found.</p>';
        return;
    }

    historicalPlaces.forEach(historicalPlace => {
        const HPDiv = document.createElement('div');
        HPDiv.className = 'historical-place';
        HPDiv.innerHTML = `
            <h3 style="display: inline;">${historicalPlace.name}</h3>
            <button onclick="toggleDetails(this)" style="margin-left: 10px;">View Details</button>
            <div class="details" style="display: none;">
                <p>Description: ${historicalPlace.description}</p>
                <p>Pictures: ${historicalPlace.pictures.join(', ')}</p>
                <p>Location: ${historicalPlace.location}</p>
                <p>Opening Hours: ${historicalPlace.openingHours}</p>
                <p>Ticket Prices: Foreigner: ${historicalPlace.ticketPrices.foreigner}, Native: ${historicalPlace.ticketPrices.native}, Student: ${historicalPlace.ticketPrices.student}</p>
                <p>Author: ${historicalPlace.AuthorUsername}</p>
                <p>Tags: ${historicalPlace.Tags.join(', ')}</p>
                <p>Date of Event: ${historicalPlace.dateOfEvent ? new Date(historicalPlace.dateOfEvent).toLocaleDateString() : 'N/A'}</p>
            </div>
        `;
        container.appendChild(HPDiv);
    });
}


function populateProfileForm(profile) {
    document.getElementById('username').value = profile.Username || '';
    document.getElementById('password').value = profile.Password || '';
    document.getElementById('email').value = profile.Email || '';
    document.getElementById('mobileNumber').value = profile.MobileNumber || '';
    document.getElementById('doB').value = profile.DoB || '';
    document.getElementById('nationality').value = profile.Nationality || '';
    document.getElementById('occupation').value = profile.Occupation || '';

    // Update to display "0" if the wallet is 0
    document.getElementById('wallet').value = profile.Wallet !== null && profile.Wallet !== undefined ? profile.Wallet : '0';
}

function openModal() {
    document.getElementById("profileModal").style.display = "block";
}

function closeModal() {
    document.getElementById("profileModal").style.display = "none";
}

async function saveProfile() {
    const Password = document.getElementById('password').value;
    const Email = document.getElementById('email').value;
    const MobileNumber = document.getElementById('mobileNumber').value;
    const Nationality = document.getElementById('nationality').value;
    const Occupation = document.getElementById('occupation').value;

    const Username = document.getElementById('username').value; // Keep username for the update
    try {
        const response = await fetch('/api/updateTourist', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ Username, Password, Email, MobileNumber, Nationality, Occupation }) 
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Error updating tourist information');
        }

        alert('Profile updated successfully!');
        closeModal(); // Close the modal on successful save
    } catch (error) {
        console.error('Error:', error);
        alert('Failed to update profile: ' + error.message);
    }
}

window.onclick = function(event) {
    if (event.target == document.getElementById("activitiesModal")) {
        closeActivitiesModal();
    }
    if (event.target == document.getElementById("profileModal")) {
        closeModal();
    }
    if (event.target == document.getElementById("itineraryModal")) {
        closeItineraryModal();
    }
};

document.getElementById('filter').addEventListener('click', async () => {
        const category = document.getElementById('category').value;
        const minPrice = document.getElementById('minPrice1').value;
        const maxPrice = document.getElementById('maxPrice1').value;
        const inputDate = document.getElementById('InputDate').value;
        const rating = document.getElementById('Rating').value;

        // Prepare the request body
        const requestBody = {
            Category: category || undefined,
            minPrice: minPrice ? parseFloat(minPrice) : undefined,
            maxPrice: maxPrice ? parseFloat(maxPrice) : undefined,
            InputDate: inputDate || undefined,
            Rating: rating ? parseInt(rating) : undefined
        };

        try {
            // Send a request to the filterActivities endpoint
            const response = await fetch('/api/filterActivities', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                const errorData = await response.json();
                alert(errorData.msg); // Display error message if no activities found
                return;
            }

            const activities = await response.json();
            displayActivities(activities); // Display filtered activities
        } catch (error) {
            console.error('Error fetching activities:', error);
            alert('An error occurred while fetching activities.');
        }
    });

    document.getElementById('filter1').addEventListener('click', async () => {
    const Language = document.getElementById('language').value;
    const minPrice = document.getElementById('minPrice2').value;
    const maxPrice = document.getElementById('maxPrice2').value;
    const InputDate = document.getElementById('InputDate2').value;
    //const Tags = document.getElementById('tags').value.split(',').map(tag => tag.trim()); // Split and trim tags
    const tagsInput = document.getElementById('tags2').value;
    const Tags2 = tagsInput ? tagsInput.split(',').map(tag => tag.trim()) : [];

    // Prepare the request body matching the schema attributes
    const requestBody = {
        Language: Language || undefined,
        MinPrice: minPrice ? parseFloat(minPrice) : undefined,
        maxPrice: maxPrice ? parseFloat(maxPrice) : undefined,
        InputDate: InputDate || undefined,
        Tags: Tags2.length > 0 ? Tags2 : undefined
    };
    console.log(requestBody);
    try {
        // Send a request to the filterItineraries endpoint
        const response = await fetch('/api/filterItinerariesTourist', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestBody)
        });

        if (!response.ok) {
            const errorData = await response.json();
            alert(errorData.msg); // Display error message if no itineraries found
            return;
        }

        const itineraries = await response.json();
        displayItineraries(itineraries); // Display filtered itineraries
    } catch (error) {
        console.error('Error fetching itineraries:', error);
        alert('An error occurred while fetching itineraries.');
    }
});

// Event listener for the search button
document.getElementById('searchButton').addEventListener('click', async () => {
    const searchKeyword = document.getElementById('search').value;

    // Prepare the search request body
    const requestBody = {
        searchString: searchKeyword || undefined
    };

    try {
        // Send a request to the search endpoint
        const response = await fetch('/api/ActivitiesSearchAll', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestBody)
        });

        if (!response.ok) {
            const errorData = await response.json();
            alert(errorData.msg); // Display error message if no activities found
            return;
        }

        const activities = await response.json();
        displayActivities(activities); // Function to display the fetched activities
    } catch (error) {
        console.error('Error searching activities:', error);
        alert('An error occurred while searching activities.');
    }
});

// Event listener for the museum search button
document.getElementById('museumSearchButton').addEventListener('click', async () => {
    const searchKeyword = document.getElementById('museumSearch').value;

    // Prepare the search request body
    const requestBody = {
        searchString: searchKeyword || undefined
    };

    try {
        // Send a request to the search endpoint for museum events
        const response = await fetch('/api/MuseumSearchAll', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestBody)
        });

        if (!response.ok) {
            const errorData = await response.json();
            alert(errorData.msg); // Display error message if no museums found
            return;
        }

        const museums = await response.json();
        displayMuseums(museums); // Function to display the fetched museum events
    } catch (error) {
        console.error('Error searching museums:', error);
        alert('An error occurred while searching museum events.');
    }
});

// Event listener for the itinerary search button
document.getElementById('itinerarySearchButton').addEventListener('click', async () => {
    const searchTerm = document.getElementById('itinerarySearch').value;

    // Prepare the search request body
    const requestBody = {
        searchString: searchTerm || undefined
    };

    try {
        // Send a request to the search endpoint for itinerary events
        const response = await fetch('/api/ItinerarySearchAll', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestBody)
        });

        if (!response.ok) {
            const errorData = await response.json();
            alert(errorData.msg); // Display error message if no itineraries found
            return;
        }

        const itineraries = await response.json();
        displayItineraries(itineraries); // Function to display the fetched itinerary events
    } catch (error) {
        console.error('Error searching itineraries:', error);
        alert('An error occurred while searching itinerary events.');
    }
});


document.getElementById('searchHistoricalPlacesButton').addEventListener('click', async () => {
    const searchString = document.getElementById('historicalPlacesSearch').value;

    try {
        const response = await fetch('/api/HistoricalPlacesSearchAll', { // Adjust the API endpoint as necessary
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ searchString }), // Send the search string to the API
        });

        if (!response.ok) {
            const errorData = await response.json();
            alert(errorData.msg);
            return;
        }

        const fetchedHistoricalPlaces = await response.json();
        displayHistoricalPlaces(fetchedHistoricalPlaces); // Call function to display results
    } catch (error) {
        console.error('Error searching historical places:', error);
        alert('An error occurred while searching for historical places.');
    }
});

async function viewAllProducts() {
    try {
        const response = await fetch('/api/viewAllProductsSeller');
        const products = await response.json();

        if (response.ok) {
            displayProducts(products);
            openProductsModal(); // Open the products modal
        } else {
            alert('Failed to fetch products: ' + (products.error || 'Unknown error'));
        }
    } catch (error) {
        console.error('Error fetching products:', error);
        alert('An error occurred while loading products.');
    }
}

function displayProducts(products, showEditButton = false) {
    const productsList = document.getElementById('productsList');
    productsList.innerHTML = ''; // Clear previous products

    products.forEach(product => {
        const productDiv = document.createElement('div');
        productDiv.classList.add('activity');

        productDiv.innerHTML = `
            <img src="${product.Picture}" alt="${product.Name}">
            <div>
                <h3>${product.Name}</h3>
                <p>Price: $${product.Price}</p>
                <p>Description: ${product.Description}</p>
                <p>Quantity: ${product.Quantity}</p>
                <p>Seller: ${product.Seller}</p>
                <p>Rating: ${product.Ratings}</p>
                <p>Reviews: ${product.Reviews}</p>
                ${showEditButton ? `<button onclick='openEditProductModal(${JSON.stringify(product)})'>Edit</button>` : ''}
            </div>
        `;

        productsList.appendChild(productDiv);
    });
}


document.getElementById('filterMuseums').addEventListener('click', async () => {
    const tagsInput = document.getElementById('tags').value;
    const tags = tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag !== '');

    if (tags.length === 0) {
        alert('Please enter at least one tag to filter.');
        return;
    }

    try {
        const response = await fetch('/api/getMuseumsByTagGuest', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ tags })
        });

        if (!response.ok) {
            const errorData = await response.json();
            alert(errorData.error || 'Failed to fetch museums.');
            return;
        }

        const museums = await response.json();
        displayMuseums(museums); // Display filtered museums
    } catch (error) {
        console.error('Error fetching filtered museums:', error);
        alert('An error occurred while fetching museums.');
    }
});

document.getElementById('filterHistoricalPlaces').addEventListener('click', async () => {
    const tagsInput = document.getElementById('historicalTags').value;
    const tags = tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag !== '');

    if (tags.length === 0) {
        alert('Please enter at least one tag to filter.');
        return;
    }

    try {
        const response = await fetch('/api/getHistoricalPlacesByTagGuest', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ tags })
        });

        if (!response.ok) {
            const errorData = await response.json();
            alert(errorData.error || 'Failed to fetch historical places.');
            return;
        }

        const historicalPlaces = await response.json();
        displayHistoricalPlaces(historicalPlaces); // Display filtered historical places
    } catch (error) {
        console.error('Error fetching filtered historical places:', error);
        alert('An error occurred while fetching historical places.');
    }
});








</script>

</body>
</html>