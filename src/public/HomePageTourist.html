<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tourist</title>
    <style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
}

.header {
    background-color: #4CAF50; /* Header background color */
    color: white;
    padding: 20px;
    text-align: center;
}

.header h1 {
    margin: 0;
}

.button-container {
    margin-top: 10px;
    text-align: center; /* Center the buttons */
}

button {
    background-color: #4CAF50; /* Button color */
    color: white;
    border: none;
    padding: 10px 15px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 5px; /* Space between buttons */
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s;
}

button:hover {
    background-color: #45a049; /* Darker green on hover */
}

.search-container {
    padding: 20px;
    text-align: center;
}

#searchInput {
    padding: 10px;
    width: 300px;
    border-radius: 5px;
    border: 1px solid #ccc;
}

.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto; /* 15% from the top and centered */
    padding: 20px;
    border: 1px solid #888;
    width: 80%; /* Could be more or less, depending on screen size */
    border-radius: 10px;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

h2 {
    text-align: center;
    color: #333;
}

.form-row {
    margin-bottom: 10px;
}

label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

input[type="text"],
input[type="email"],
input[type="number"],
input[type="date"],
input[type="url"],
input[type="password"] {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
}

#filter {
    margin-top: 10px;
}

.activity, .museum, .itinerary, .historical-place {
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 10px;
    margin: 10px 0;
    background-color: #fff;
}

.details {
    margin-top: 10px;
    padding: 10px;
    border: 1px dashed #ccc;
    border-radius: 5px;
    background-color: #f9f9f9;
}

.details p {
    margin: 5px 0;
}
    </style>
</head>
<body>

<div class="header">
    <h1>Beyond Borders</h1>
    <div>
        <button onclick="viewAllActivities()">View All Activities</button>
        <button onclick="viewAllMuseums()">View All Museums</button>
        <button onclick="viewAllItineraries()">View All Itineraries</button>
        <button onclick="viewAllHistoricalPlaces()">View All Historical Places</button>
        <button onclick="readMyProfile()">My Profile</button>
    </div>
    
</div>
<div class="search-container"></div>
    <input type="text" id="searchInput" placeholder="Search for a product by name...">
    <button class="search-button" onclick="searchActivity()">Search Activities</button>
</div>

<div id="activitiesModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeActivitiesModal()">&times;</span>
        <h2>Upcoming Activities</h2>

        <!-- Filter Options -->
        <label for="category">Category:</label>
        <input type="text" id="category" placeholder="Enter category" />

        <label for="minPrice">Min Price:</label>
        <input type="number" id="minPrice" placeholder="Minimum Price" />

        <label for="maxPrice">Max Price:</label>
        <input type="number" id="maxPrice" placeholder="Maximum Price" />

        <label for="InputDate">Date:</label>
        <input type="date" id="InputDate" />

        <label for="Rating">Rating:</label>
        <input type="number" id="Rating" min="1" max="5" placeholder="Rating (1-5)" />
        
        <button id="filter">Apply Filter</button>

        <!-- Container for displaying activities -->
        <div id="activitiesContainerModal">
            <!-- Activities will be displayed here -->
        </div>
    </div>
</div>

<!-- Modal for Activities -->
<div id="activitiesModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeActivitiesModal()">&times;</span>
        <h2>Upcoming Activities</h2>
        <div id="activitiesContainerModal">
            <!-- Activities will be displayed here -->
        </div>
    </div>
</div>

<!-- Modal for Museums -->
<div id="museumsModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeMuseumsModal()">&times;</span>
        <h2>Upcoming Museum Events</h2>
        <div id="museumsContainerModal">
            <!-- Museums will be displayed here -->
        </div>
    </div>
</div>

<div id="itineraryModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeItineraryModal()">&times;</span>
        <h2>Upcoming Itinerary Events</h2>
        <div id="itineraryContainerModal">
            <!-- Itineraries will be displayed here -->
        </div>
    </div>
</div>

<div id="HistoricalPlacesModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeHistoricalPlacesModal()">&times;</span>
        <h2>Upcoming Historical Places Events</h2>
        <div id="HistoricalPlacesContainerModal">
            <!-- Historical Places will be displayed here -->
        </div>
    </div>
</div>


<!-- Modal for Profile -->
<div id="profileModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>My Profile</h2>
        <form id="profile-form">
            <div class="form-row">
                <label for="username">Username:</label>
                <input type="text" id="username" readonly>
            </div>
            <div class="form-row">
                <label for="email">Email Address:</label>
                <input type="email" id="email">
            </div>
            <div class="form-row">
                <label for="password">Password:</label>
                <input type="password" id="password">
            </div>
            <div class="form-row">
                <label for="mobileNumber">Mobile Number</label>
                <input type="text" id="mobileNumber">
            </div>
            <div class="form-row">
                <label for="doB">Date of Birth:</label>
                <input type="text" id="doB" readonly>
            </div>
            <div class="form-row">
                <label for="nationality">Nationality:</label>
                <input type="url" id="nationality">
            </div>
            <div class="form-row">
                <label for="occupation">Occupation:</label>
                <input type="url" id="occupation">
            </div>
            <div>
                <label for="wallet">Wallet:</label>
                <input type="url" id="wallet" readonly>
            </div>
            <button type="button" id="save-changes-btn" onclick="saveProfile()">Save Changes</button>
        </form>
    </div>
</div>



<script>
function toggleDetails(button) {
    const details = button.nextElementSibling; // Get the details div
    if (details.style.display === "none") {
        details.style.display = "block"; // Show details
    } else {
        details.style.display = "none"; // Hide details
    }
}

function toggleDetails(button) {
        const detailsDiv = button.nextElementSibling;
        detailsDiv.style.display = detailsDiv.style.display === 'none' ? 'block' : 'none';
    }

async function readMyProfile() {
    const username = localStorage.getItem('username');
    if (!username) {
        alert('You need to log in first.');
        return;
    }

    try {
        const response = await fetch(`/api/viewTourist?Username=${encodeURIComponent(username)}`);
        const data = await response.json();

        if (response.ok) {
            console.log(data);
            populateProfileForm(data); // No need to access 'Tourist' as the user is directly returned
            openModal(); // Open profile modal
        } else {
            alert(data.msg); // Use 'msg' instead of 'error' based on the API response
        }
    } catch (error) {
        console.error('Error fetching profile:', error);
        alert('An error occurred while loading profile.');
    }
}

async function viewAllActivities() {
    try {
        const response = await fetch('/api/ViewAllUpcomingActivities');
        const activities = await response.json();

        if (response.ok) {
            displayActivities(activities);
            openActivitiesModal(); // Open the activities modal
        } else {
            alert('Failed to fetch activities: ' + (activities.error || 'Unknown error'));
        }
    } catch (error) {
        console.error('Error fetching activities:', error);
        alert('An error occurred while loading activities.');
    }
}

async function viewAllMuseums() {
    try {
        const response = await fetch('/api/ViewAllUpcomingMuseumEventsTourist');
        const museums = await response.json();

        if (response.ok) {
            displayMuseums(museums);
            openMuseumsModal(); // Open the museums modal
        } else {
            alert('Failed to fetch museums: ' + (museums.error || 'Unknown error'));
        }
    } catch (error) {
        console.error('Error fetching museums:', error);
        alert('An error occurred while loading museums.');
    }
}

async function viewAllItineraries() {
    try {
        const response = await fetch('/api/ViewAllUpcomingItinerariesTourist');
        const itineraries = await response.json();

        if (response.ok) {
            displayItineraries(itineraries);
            openItineraryModal(); 
        } else {
            alert('Failed to fetch itineraries: ' + (itineraries.error || 'Unknown error'));
        }
    } catch (error) {
        console.error('Error fetching itineraries:', error);
        alert('An error occurred while loading itineraries.');
    }
}

async function viewAllHistoricalPlaces() {
    try {
        const response = await fetch('/api/ViewAllUpcomingHistoricalPlacesEventsTourist');
        const historicalPlaces = await response.json();

        if (response.ok) {
            displayHistoricalPlaces(historicalPlaces);
            openHistoricalPlacesModal(); // Open the HistoricalPlaces modal
        } else {
            alert('Failed to fetch historical places: ' + (historicalPlaces.error || 'Unknown error'));
        }
    } catch (error) {
        console.error('Error fetching Historical Places:', error);
        alert('An error occurred while loading historical places.');
    }
}

async function searchActivity() {
    const searchName = document.getElementById('searchInput').value.trim(); // Correct ID for input
    if (!searchName) {
        alert('Please enter a product name to search.');
        return;
    }

    try {
        const response = await fetch(`/api/viewProductsSeller?Name=${encodeURIComponent(searchName)}`, {
            method: 'GET', // Use GET for query parameters
            headers: {
                'Content-Type': 'application/json'
            }
        });

        const products = await response.json();

        if (response.ok) {
            displayProducts(products);
            openProductsModal();
        } else {
            alert(products.error || 'No products found.');
        }
    } catch (error) {
        console.error('Error fetching products:', error);
        alert('An error occurred while searching for products.');
    }
}

function openActivitiesModal() {
        document.getElementById("activitiesModal").style.display = "block";
    }

    function closeActivitiesModal() {
        document.getElementById("activitiesModal").style.display = "none";
    }

function openMuseumsModal() {
    document.getElementById("museumsModal").style.display = "block"; // Open the museums modal
}

function closeMuseumsModal() {
    document.getElementById("museumsModal").style.display = "none"; // Close the museums modal
}

function openItineraryModal() {
    document.getElementById("itineraryModal").style.display = "block"; // Open the museums modal
}

function closeItineraryModal() {
    document.getElementById("itineraryModal").style.display = "none"; // Close the museums modal
}

function openHistoricalPlacesModal() {
    document.getElementById("HistoricalPlacesModal").style.display = "block"; // Open the Historical Places modal
}

function closeHistoricalPlacesModal() {
    document.getElementById("HistoricalPlacesModal").style.display = "none"; // Close the Historical Places modal
}

function displayActivities(activities) {
        const container = document.getElementById('activitiesContainerModal');
        container.innerHTML = ''; // Clear previous activities

        if (activities.length === 0) {
            container.innerHTML = '<p>No activities found.</p>';
            return;
        }

        activities.forEach(activity => {
            const activityDiv = document.createElement('div');
            activityDiv.className = 'activity';
            activityDiv.innerHTML = `
                <h3 style="display: inline;">${activity.Name}</h3>
                <button onclick="toggleDetails(this)" style="margin-left: 10px;">View Details</button>
                <div class="details" style="display: none;">
                    <p>Date: ${new Date(activity.Date).toLocaleDateString()}</p>
                    <p>Time: ${activity.Time}</p>
                    <p>Price: $${activity.Price}</p>
                    <p>Rating: ${activity.Rating}</p>
                    <p>Location: ${activity.Location.address || 'N/A'}</p>
                    <p>Category: ${activity.Category}</p>
                    <p>Tags: ${activity.Tags.join(', ')}</p>
                    <p>Special Discount: ${activity.SpecialDiscount || 'N/A'}</p>
                    <p>Booking Status: ${activity.BookingOpen}</p>
                </div>
            `;
            container.appendChild(activityDiv);
        });
    }

function displayMuseums(museums) {
    const container = document.getElementById('museumsContainerModal');
    container.innerHTML = ''; // Clear previous museums

    if (museums.length === 0) {
        container.innerHTML = '<p>No museums found.</p>';
        return;
    }

    museums.forEach(museum => {
        const museumDiv = document.createElement('div');
        museumDiv.className = 'museum';
        museumDiv.innerHTML = `
            <h3 style="display: inline;">${museum.name}</h3>
            <button onclick="toggleDetails(this)" style="margin-left: 10px;">View Details</button>
            <div class="details" style="display: none;">
                <p>Description: ${museum.description}</p>
                <p>Pictures: ${museum.pictures.join(', ')}</p>
                <p>Location: ${museum.location}</p>
                <p>Opening Hours: ${museum.openingHours}</p>
                <p>Ticket Prices: Foreigner: ${museum.ticketPrices.foreigner}, Native: ${museum.ticketPrices.native}, Student: ${museum.ticketPrices.student}</p>
                <p>Author: ${museum.AuthorUsername}</p>
                <p>Historical Tags: ${museum.HistoricalTags.join(', ')}</p>
                <p>Date of Event: ${museum.dateOfEvent ? new Date(museum.dateOfEvent).toLocaleDateString() : 'N/A'}</p>
            </div>
        `;
        container.appendChild(museumDiv);
    });
}

function displayItineraries(itineraries) {
    const container = document.getElementById('itineraryContainerModal');
    container.innerHTML = ''; 

    if (itineraries.length === 0) {
        container.innerHTML = '<p>No itineraries found.</p>';
        return;
    }

    itineraries.forEach(itinerary => {
    const itineraryDiv = document.createElement('div');
    itineraryDiv.className = 'itinerary';
    itineraryDiv.innerHTML = `
        <h3 style="display: inline;">${itinerary.Title}</h3>
        <button onclick="toggleDetails(this)" style="margin-left: 10px;">View Details</button>
        <div class="details" style="display: none;">
            <p>Activities: ${itinerary.Activities}</p>
            <p>Locations: ${itinerary.Locations}</p>
            <p>Timeline: ${itinerary.Timeline}</p>
            <p>Language: ${itinerary.Language}</p>
            <p>Price: $${itinerary.Price}</p>
            <p>Date: ${new Date(itinerary.Date).toLocaleDateString()}</p>
            <p>Accessibility: ${itinerary.accessibility ? 'Yes' : 'No'}</p>
            <p>Pickup Location: ${itinerary.pickupLocation}</p>
            <p>Dropoff Location: ${itinerary.dropoffLocation}</p>
            <p>Is Booked: ${itinerary.isBooked ? 'Yes' : 'No'}</p>
            <p>Tags: ${itinerary.Tags.join(', ')}</p>
            <p>Author: ${itinerary.AuthorUsername}</p>
        </div>
    `;
    container.appendChild(itineraryDiv);
});
}

function displayHistoricalPlaces(historicalPlaces) {
    const container = document.getElementById('HistoricalPlacesContainerModal');
    container.innerHTML = ''; // Clear previous Historical Places

    if (historicalPlaces.length === 0) {
        container.innerHTML = '<p>No Historical Places found.</p>';
        return;
    }

    historicalPlaces.forEach(historicalPlace => {
        const HPDiv = document.createElement('div');
        HPDiv.className = 'historical-place';
        HPDiv.innerHTML = `
            <h3 style="display: inline;">${historicalPlace.name}</h3>
            <button onclick="toggleDetails(this)" style="margin-left: 10px;">View Details</button>
            <div class="details" style="display: none;">
                <p>Description: ${historicalPlace.description}</p>
                <p>Pictures: ${historicalPlace.pictures.join(', ')}</p>
                <p>Location: ${historicalPlace.location}</p>
                <p>Opening Hours: ${historicalPlace.openingHours}</p>
                <p>Ticket Prices: Foreigner: ${historicalPlace.ticketPrices.foreigner}, Native: ${historicalPlace.ticketPrices.native}, Student: ${historicalPlace.ticketPrices.student}</p>
                <p>Author: ${historicalPlace.AuthorUsername}</p>
                <p>Tags: ${historicalPlace.Tags.join(', ')}</p>
                <p>Date of Event: ${historicalPlace.dateOfEvent ? new Date(historicalPlace.dateOfEvent).toLocaleDateString() : 'N/A'}</p>
            </div>
        `;
        container.appendChild(HPDiv);
    });
}


function populateProfileForm(profile) {
    document.getElementById('username').value = profile.Username || '';
    document.getElementById('password').value = profile.Password || '';
    document.getElementById('email').value = profile.Email || '';
    document.getElementById('mobileNumber').value = profile.MobileNumber || '';
    document.getElementById('doB').value = profile.DoB || '';
    document.getElementById('nationality').value = profile.Nationality || '';
    document.getElementById('occupation').value = profile.Occupation || '';
    document.getElementById('wallet').value = profile.Wallet !== null && profile.Wallet !== undefined ? profile.Wallet : '';
}

function openModal() {
    document.getElementById("profileModal").style.display = "block";
}

function closeModal() {
    document.getElementById("profileModal").style.display = "none";
}

async function saveProfile() {
    const Password = document.getElementById('password').value;
    const Email = document.getElementById('email').value;
    const MobileNumber = document.getElementById('mobileNumber').value;
    const Nationality = document.getElementById('nationality').value;
    const Occupation = document.getElementById('occupation').value;

    const Username = document.getElementById('username').value; // Keep username for the update
    try {
        const response = await fetch('/api/updateTourist', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ Username, Password, Email, MobileNumber, Nationality, Occupation }) 
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Error updating tourist information');
        }

        alert('Profile updated successfully!');
        closeModal(); // Close the modal on successful save
    } catch (error) {
        console.error('Error:', error);
        alert('Failed to update profile: ' + error.message);
    }
}

window.onclick = function(event) {
    if (event.target == document.getElementById("activitiesModal")) {
        closeActivitiesModal();
    }
    if (event.target == document.getElementById("profileModal")) {
        closeModal();
    }
};

document.getElementById('filter').addEventListener('click', async () => {
        const category = document.getElementById('category').value;
        const minPrice = document.getElementById('minPrice').value;
        const maxPrice = document.getElementById('maxPrice').value;
        const inputDate = document.getElementById('InputDate').value;
        const rating = document.getElementById('Rating').value;

        // Prepare the request body
        const requestBody = {
            Category: category || undefined,
            minPrice: minPrice ? parseFloat(minPrice) : undefined,
            maxPrice: maxPrice ? parseFloat(maxPrice) : undefined,
            InputDate: inputDate || undefined,
            Rating: rating ? parseInt(rating) : undefined
        };

        try {
            // Send a request to the filterActivities endpoint
            const response = await fetch('/api/filterActivities', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                const errorData = await response.json();
                alert(errorData.msg); // Display error message if no activities found
                return;
            }

            const activities = await response.json();
            displayActivities(activities); // Display filtered activities
        } catch (error) {
            console.error('Error fetching activities:', error);
            alert('An error occurred while fetching activities.');
        }
    });



</script>

</body>
</html>